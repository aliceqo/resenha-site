document.addEventListener('DOMContentLoaded', () => {
    function formatarTitulo(titulo) {
        return titulo
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .replace(/ /g, '-')
            .toLowerCase();
    }

    fetch('/back-end/pegarResenhas')
        .then(response => {
            console.log('Resposta do backend:', response);
            return response.json();
        })
        .then(resenhas => {
            console.log('Resenhas recebidas:', resenhas);

            resenhas.forEach(resenha => {
                if (resenha.destaque_posicao === 0) {
                    console.warn('Resenha com destaque_posicao 0 ignorada.');
                    return;
                }

                const livroElemento = document.getElementById(`livro-${resenha.destaque_posicao}`);
                if (livroElemento) {
                    console.log(`Atualizando elemento com id livro-${resenha.destaque_posicao}`);

                    livroElemento.innerHTML = '';

                    const img = document.createElement('img');
                    img.src = resenha.url_foto;
                    img.alt = resenha.titulo;

                    const title = document.createElement('h3');
                    title.textContent = resenha.titulo;

                    const link = document.createElement('a');
                    link.href = `resenhas/${formatarTitulo(resenha.titulo)}.html`;
                    link.textContent = 'Ver Resenha';

                    livroElemento.appendChild(img);
                    livroElemento.appendChild(title);
                    livroElemento.appendChild(link);
                } else {
                    console.error(`Elemento com id livro-${resenha.destaque_posicao} nÃ£o encontrado.`);
                }
            });
        })
        .catch(error => {
            console.error('Erro ao carregar resenhas:', error);
        });
});
