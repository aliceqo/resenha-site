document.addEventListener('DOMContentLoaded', function () {
    console.log('JavaScript carregado e executando');
    const resenhaId = obterIdResenha();
    if (resenhaId) {
        console.log('ID da resenha:', resenhaId);
        carregarDadosResenha(resenhaId);
    } else {
        console.error('ID da resenha não encontrado');
    }
});

function carregarDadosResenha(id) {
    fetch(`/back-end/excluirEditar?id=${id}`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`Erro ao carregar os dados da resenha: ${response.statusText}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Dados da resenha:', data);

            atualizarElemento('imagem_capa', data.url_foto, 'src');
            atualizarElemento('titulo', data.titulo);
            atualizarElemento('idade_leitura', data.idade_leitura);
            atualizarElemento('livro', data.livro);
            atualizarElemento('autor', data.autor);
            atualizarElemento('tradutor', data.tradutor);
            atualizarElemento('generos', data.generos);
            atualizarElemento('idioma', data.idioma);
            atualizarElemento('editora', data.editora);
            
            // Atualização específica para o campo numérico
            atualizarElemento('numero_paginas', data.numero_paginas, 'value', true);
            
            atualizarElemento('frase_destaque', data.frase_destaque);
            atualizarElemento('conteudo_resenha', data.conteudo_resenha, 'innerText');
        })
        .catch(error => {
            console.error('Erro ao carregar os dados da resenha:', error);
        });
}

function atualizarElemento(id, valor, atributo, forNumber) {
    const elemento = document.getElementById(id);
    if (elemento) {
        if (atributo === 'src' && elemento.tagName === 'IMG') {
            elemento.src = valor || 'Não disponível';
        } else if (atributo === 'value' || !atributo) {
            if (forNumber) {
                elemento.valueAsNumber = valor; // Use valueAsNumber for numeric fields
            } else {
                elemento.value = valor || '';
            }
        } else if (atributo === 'innerText') {
            elemento.innerText = valor || 'Não disponível';
        }
    } else {
        console.error(`Elemento com ID ${id} não encontrado`);
    }
}

function obterIdResenha() {
    const params = new URLSearchParams(window.location.search);
    return params.get('id');
}
document.addEventListener("DOMContentLoaded", function() {
    const editarButton = document.getElementById("bot-editar-resenha");
    const excluirButton = document.getElementById("bot-excluir-resenha");

    // Editar Resenha
    editarButton.addEventListener("click", function(event) {
        event.preventDefault(); // Evita o envio padrão do formulário

        const resenhaId = document.getElementById("resenhaId").value;
        const form = document.getElementById("form-edit-resenha");
        const formData = new FormData(form);

        fetch(`/back-end/excluirEditar?id=${resenhaId}`, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("Resenha editada com sucesso!");
                // Redirecionar ou atualizar a página conforme necessário
            } else {
                alert("Erro ao editar a resenha: " + data.message);
            }
        })
        .catch(error => {
            console.error('Erro ao editar a resenha:', error);
        });
    });

    // Excluir Resenha
    excluirButton.addEventListener("click", function(event) {
        event.preventDefault(); // Evita o envio padrão do formulário

        const resenhaId = document.getElementById("resenhaId").value;

        if (confirm("Tem certeza que deseja excluir esta resenha?")) {
            fetch(`/back-end/excluirEditar?id=${resenhaId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert("Resenha excluída com sucesso!");
                    // Redirecionar ou atualizar a página conforme necessário
                } else {
                    alert("Erro ao excluir a resenha: " + data.message);
                }
            })
            .catch(error => {
                console.error('Erro ao excluir a resenha:', error);
            });
        }
    });
});