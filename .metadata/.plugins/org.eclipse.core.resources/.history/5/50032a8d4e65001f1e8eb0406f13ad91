document.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const resenhaId = urlParams.get('id');

  fetch(`/back-end/editarExcluir?id=${resenhaId}`)
    .then(response => response.json())
    .then(data => {
      const formElements = [
        { id: 'resenhaId', value: data.id },
        { id: 'url_foto', value: data.urlFoto },
        { id: 'titulo', value: data.titulo },
        { id: 'idade_leitura', value: data.idadeLeitura },
        { id: 'livro', value: data.livro },
        { id: 'autor', value: data.autor },
        { id: 'tradutor', value: data.tradutor },
        { id: 'generos', value: data.generos },
        { id: 'idioma', value: data.idioma },
        { id: 'editora', value: data.editora },
        { id: 'numero_paginas', value: data.numeroPaginas }, // fixed typo
        { id: 'frase_destaque', value: data.fraseDestaque },
        { id: 'conteudo_resenha', value: data.conteudoResenha },
      ];

      formElements.forEach(element => {
        document.getElementById(element.id).value = element.value;
      });
    })
    .catch(error => console.error('Erro ao buscar resenha:', error));

  const formEditResenha = document.getElementById('form-edit-resenha');
  formEditResenha.addEventListener('submit', function(event) {
    event.preventDefault();

    const resenhaData = {
      id: document.getElementById('resenhaId').value,
      urlFoto: document.getElementById('url_foto').value,
      titulo: document.getElementById('titulo').value,
      idadeLeitura: document.getElementById('idade_leitura').value,
      livro: document.getElementById('livro').value,
      autor: document.getElementById('autor').value,
      tradutor: document.getElementById('tradutor').value,
      generos: document.getElementById('generos').value,
      idioma: document.getElementById('idioma').value,
      editora: document.getElementById('editora').value,
      numeroPaginas: document.getElementById('numero_paginas').value,
    };

    const fraseData = {
      fraseDestaque: document.getElementById('frase_destaque').value,
      conteudoResenha: document.getElementById('conteudo_resenha').value,
    };

    const formData = { ...resenhaData, ...fraseData }; // merged objects

    fetch('/EditarResenhaServlet', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(formData)
    })
    .then(response => {
      if (response.ok) {
        alert('Resenha atualizada com sucesso!');
        window.location.href = '/resenhas.html';
      } else {
        throw new Error('Erro ao atualizar a resenha.');
      }
    })
    .catch(error => console.error('Erro:', error));
  });
});