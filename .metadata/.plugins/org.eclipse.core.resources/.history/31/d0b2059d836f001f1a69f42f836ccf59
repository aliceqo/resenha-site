// Função para capturar o valor de um parâmetro da URL
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Função para preencher o formulário com os dados da resenha
function preencherFormulario(dados) {
    document.getElementById('resenhaId').value = dados.id || ''; // ID da resenha
    document.getElementById('titulo').value = dados.titulo || '';
    document.getElementById('idade_leitura').value = dados.idade_leitura || '';
    document.getElementById('livro').value = dados.livro || '';
    document.getElementById('autor').value = dados.autor || '';
    document.getElementById('tradutor').value = dados.tradutor || '';
    document.getElementById('generos').value = dados.generos || '';
    document.getElementById('idioma').value = dados.idioma || '';
    document.getElementById('editora').value = dados.editora || '';
    document.getElementById('numero_paginas').value = dados.numero_paginas || '';
    document.getElementById('frase_destaque').value = dados.frase_destaque || '';
    document.getElementById('conteudo_resenha').value = dados.conteudo_resenha || '';

    // Exibir a imagem da capa
    const urlFoto = dados.url_foto;
    if (urlFoto) {
        document.getElementById('imagem_capa').src = urlFoto;
    }
}

// Função para carregar os dados da resenha com base no ID
function carregarResenha() {
    const resenhaId = getQueryParam('id'); // Pega o parâmetro 'id' da URL

    if (resenhaId) {
        // Faz uma requisição GET para o servlet
        fetch(`/back-end/excluirEditar?id=${resenhaId}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error(data.error);
                    alert('Erro ao carregar a resenha');
                } else {
                    preencherFormulario(data);
                }
            })
            .catch(error => {
                console.error('Erro na requisição:', error);
                alert('Erro ao carregar os dados da resenha');
            });
    } else {
        alert('ID da resenha não encontrado na URL');
    }
}

// Chama a função ao carregar a página
document.addEventListener('DOMContentLoaded', carregarResenha);



    // Enviar dados para editar uma resenha
   /* botEditarResenha.addEventListener('click', () => {
        const formData = new FormData();

        formData.append('id', document.getElementById('resenhaId').value);
        formData.append('titulo', document.getElementById('titulo').value);
        formData.append('idade_leitura', document.getElementById('idade_leitura').value);
        formData.append('livro', document.getElementById('livro').value);
        formData.append('autor', document.getElementById('autor').value);
        formData.append('tradutor', document.getElementById('tradutor').value);
        formData.append('generos', document.getElementById('generos').value);
        formData.append('idioma', document.getElementById('idioma').value);
        formData.append('editora', document.getElementById('editora').value);

        const numeroPaginas = document.getElementById('numero_paginas').value;
        const numeroPaginasNumber = parseInt(numeroPaginas, 10);
        formData.append('numero_paginas', isNaN(numeroPaginasNumber) ? 0 : numeroPaginasNumber);

        formData.append('frase_destaque', document.getElementById('frase_destaque').value);
        formData.append('conteudo_resenha', document.getElementById('resenha').value);

        const urlFotoInput = document.getElementById('url_foto');
        if (urlFotoInput && urlFotoInput.files.length > 0) {
            formData.append('url_foto', urlFotoInput.files[0]);
        }

        fetch('/back-end/excluirEditar', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            console.log('Resenha atualizada com sucesso:', data);
            alert('Resenha atualizada com sucesso!');
        })
        .catch(error => {
            console.error('Erro ao atualizar a resenha:', error);
            alert('Erro ao atualizar a resenha.');
        });
    });

    // Excluir uma resenha
    botExcluirResenha.addEventListener('click', () => {
        const id = document.getElementById('resenhaId').value;

        fetch(`/back-end/excluirEditar?id=${id}`, {
            method: 'DELETE'
        })
        .then(response => response.text())
        .then(data => {
            console.log('Resenha excluída com sucesso:', data);
            alert('Resenha excluída com sucesso!');
        })
        .catch(error => {
            console.error('Erro ao excluir a resenha:', error);
            alert('Erro ao excluir a resenha.');
        });
    });*/