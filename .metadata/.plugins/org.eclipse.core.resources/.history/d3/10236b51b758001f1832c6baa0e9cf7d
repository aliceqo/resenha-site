document.addEventListener('DOMContentLoaded', () => {
    console.log('JavaScript carregado e executando');
  
    const pageContainer = document.getElementById('page-container');
    const menuIcon = document.querySelector('.menu-icon');
    const menuOptions = document.querySelector('.menu-options');

    console.log('Menu Icon:', menuIcon);
    console.log('Menu Options:', menuOptions);

    // Função para carregar a página via AJAX
    const loadPage = (url) => {
      fetch(url)
        .then(response => response.text())
        .then(html => {
          pageContainer.innerHTML = html;
        })
        .catch(error => console.error('Erro ao carregar a página:', error));
    };

    // Evento de clique para carregar páginas
    document.querySelectorAll('nav a').forEach(link => {
      link.addEventListener('click', (event) => {
        event.preventDefault();
        const url = link.getAttribute('href');
        loadPage(url);
      });
    });

    // Adicione um evento de clique ao ícone do menu
    if (menuIcon && menuOptions) {
      menuIcon.addEventListener('click', () => {
        console.log('Clicou no menu icon!');
        menuOptions.classList.toggle('show');
      });
    } else {
      console.error('Menu Icon ou Menu Options não encontrado!');
    }

    // Fechar o menu ao clicar fora dele
    document.addEventListener('click', (event) => {
      if (!menuOptions.contains(event.target) && event.target !== menuIcon) {
        menuOptions.classList.remove('show');
      }
    });

    document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Evita o comportamento padrão do formulário

        const searchQuery = document.getElementById('searchInput').value;

        fetch(`/api/search?query=${encodeURIComponent(searchQuery)}`)
            .then(response => response.json())
            .then(data => {
                displayResults(data);
            })
            .catch(error => console.error('Erro:', error));
    });

    function displayResults(resenhas) {
        const resultsContainer = document.getElementById('searchResults');
        resultsContainer.innerHTML = '';

        if (resenhas.length === 0) {
            resultsContainer.innerHTML = '<p>Nenhuma resenha encontrada.</p>';
            return;
        }

        const list = document.createElement('ul');
        resenhas.forEach(resenha => {
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = `/resenha?id=${resenha.id}`; // Ajuste o caminho para a página de resenha
            link.textContent = resenha.titulo;
            listItem.appendChild(link);
            list.appendChild(listItem);
        });

        resultsContainer.appendChild(list);
    }
});
