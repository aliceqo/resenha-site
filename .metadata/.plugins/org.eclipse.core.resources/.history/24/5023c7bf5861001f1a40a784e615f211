const form = document.getElementById('esqueciSenha');

form.addEventListener('submit', (e) => {
  e.preventDefault();

  const username = document.getElementById('digUsername').value;
  const resultado = document.getElementById('resultado');

	fetch('/back-end/esqueci', { 
	  method: 'POST',
	  headers: {
	    'Content-Type': 'application/x-www-form-urlencoded'
	  },
	  body: `digUsername=${encodeURIComponent(username)}` 
	})
	.then((response) => {
	  console.log('Response:', response);
	  console.log('Status:', response.status);
	  if (response.ok) {
	    window.location.href = 'redefinirSenha.html';
	  } else if (response.status === 401) {
	    if (resultado) {
		  errorMessage = 'Usuário incorreto';
	      resultado.innerHTML = errorMessage;
	      resultado.style.display = 'block'; 
	      setTimeout(() => {
	        resultado.style.display = 'none'; 
	      }, 2000); 
	    }
	  } else {
	    throw new Error('Erro desconhecido');
	  }
	})
	.catch((error) => {
	  console.error('Erro ao fazer a requisição:', error);
	});

  form.reset();
});

//redefir senha
const form = document.getElementById('redefinirSenhaForm');

  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const novaSenha = document.getElementById('novaSenha').value;
    const confirmarSenha = document.getElementById('confirmarSenha').value;

    if (novaSenha !== confirmarSenha) {
      alert('Senhas não conferem');
      return;
    }

    fetch('/back-end/redefinir', { 
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: `novaSenha=${encodeURIComponent(novaSenha)}`
    })
    .then((response) => {
      console.log('Response:', response);
      console.log('Status:', response.status);
      if (response.ok) {
        window.location.href = 'login.html';
      } else {
        throw new Error('Erro desconhecido');
      }
    })
    .catch((error) => {
      console.error('Erro ao fazer a requisição:', error);
    });
  });