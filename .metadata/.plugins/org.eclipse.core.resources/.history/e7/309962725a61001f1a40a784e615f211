const form = document.getElementById('esqueciSenha');

form.addEventListener('submit', (e) => {
  e.preventDefault();

  const username = document.getElementById('digUsername').value;
  const resultado = document.getElementById('resultado');

	fetch('/back-end/esqueci', { 
	  method: 'POST',
	  headers: {
	    'Content-Type': 'application/x-www-form-urlencoded'
	  },
	  body: `digUsername=${encodeURIComponent(username)}` 
	})
	.then((response) => {
	  console.log('Response:', response);
	  console.log('Status:', response.status);
	  if (response.ok) {
	    window.location.href = 'redefinirSenha.html';
	  } else if (response.status === 401) {
	    if (resultado) {
		  errorMessage = 'Usuário incorreto';
	      resultado.innerHTML = errorMessage;
	      resultado.style.display = 'block'; 
	      setTimeout(() => {
	        resultado.style.display = 'none'; 
	      }, 2000); 
	    }
	  } else {
	    throw new Error('Erro desconhecido');
	  }
	})
	.catch((error) => {
	  console.error('Erro ao fazer a requisição:', error);
	});

  form.reset();
});

//redefir senha
console.log(document.getElementById('redefinirSenha'));
const form2 = document.getElementById('redefinirSenha');
const urlParams = new URLSearchParams(window.location.search);
const username = urlParams.get('username');

form2.addEventListener('submit', (e) => {
  e.preventDefault();

  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const resultado = document.getElementById('resultado');

  if (newPassword !== confirmPassword) {
    errorMessage = 'Senhas não conferem';
    resultado.innerHTML = errorMessage;
    resultado.style.display = 'block'; 
    setTimeout(() => {
      resultado.style.display = 'none'; 
    }, 2000); 
    return;
  }
  else{
	  errorMessage = 'Senha redefinida com sucesso.';
	      resultado.innerHTML = errorMessage;
	      resultado.style.display = 'block'; 
	      setTimeout(() => {
	        resultado.style.display = 'none'; 
	      }, 2000); 
  }

  fetch('/back-end/redefinir', { 
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: `username=${encodeURIComponent(username)}&newPassword=${encodeURIComponent(newPassword)}`
  })
  .then((response) => {
    console.log('Response:', response);
    console.log('Status:', response.status);
    if (response.ok) {
      window.location.href = 'login.html';
    } else {
      throw new Error('Erro desconhecido');
    }
  })
  .catch((error) => {
    console.error('Erro ao fazer a requisição:', error);
  });

  form.reset();
});